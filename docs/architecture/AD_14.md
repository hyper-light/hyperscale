---
ad_number: 14
name: CRDT-Based Cross-DC Statistics
description: Use Conflict-free Replicated Data Types (CRDTs) for cross-datacenter job statistics
---

# AD-14: CRDT-Based Cross-DC Statistics

**Decision**: Use Conflict-free Replicated Data Types (CRDTs) for cross-datacenter job statistics.

**Rationale**:
- Cross-DC coordination is expensive (10-100ms+ RTT)
- Stats like `completed_count` and `failed_count` are monotonic and perfect for G-Counters
- CRDTs allow coordination-free updates with guaranteed eventual consistency
- Merge is always safe - gates can combine stats from any subset of DCs

**Implementation**:
```python
class GCounter:
    """Grow-only counter - each DC has its own slot."""
    counts: dict[str, int]  # dc_id -> count

    def increment(self, dc_id: str, amount: int = 1) -> None
    def merge(self, other: "GCounter") -> "GCounter"  # commutative, associative, idempotent
    @property
    def value(self) -> int  # sum of all slots

class JobStatsCRDT:
    """CRDT-based job statistics."""
    completed: GCounter  # Monotonic - perfect for G-Counter
    failed: GCounter     # Monotonic - perfect for G-Counter
    rates: dict[str, tuple[float, int]]  # dc -> (rate, lamport_timestamp) - LWW register
```
