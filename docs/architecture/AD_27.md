---
ad_number: 27
name: Gate Module Reorganization
description: Reorganizes gate-related code into focused modules following manager patterns
---

# AD-27: Gate Module Reorganization

**Decision**: Reorganize gate-related code into focused modules following manager patterns.

**Rationale**:
- Current gate.py is monolithic and hard to maintain
- Similar to manager refactoring already completed
- One class per file improves testability
- Clear module boundaries reduce coupling

**Proposed Structure**:
```
hyperscale/distributed_rewrite/
├── jobs/
│   ├── gates/                    # Gate-side job management
│   │   ├── __init__.py
│   │   ├── gate_job_manager.py   # Per-job state and locking
│   │   ├── job_forwarding.py     # Cross-gate job forwarding
│   │   └── consistent_hash.py    # Per-job gate ownership
│   │
│   ├── managers/                 # Manager-side (existing)
│   │   ├── __init__.py
│   │   ├── job_manager.py
│   │   ├── worker_pool.py
│   │   └── workflow_dispatcher.py
│   │
│   └── __init__.py
│
├── datacenters/                  # DC-level coordination
│   ├── __init__.py
│   ├── datacenter_health.py      # DatacenterHealthManager
│   ├── manager_dispatcher.py     # ManagerDispatcher
│   └── lease_manager.py          # DC lease management
│
├── reliability/                  # Cross-cutting reliability
│   ├── __init__.py
│   ├── retry.py                  # RetryExecutor
│   ├── circuit_breaker.py        # CircuitBreaker
│   ├── load_shedding.py          # LoadShedder
│   ├── backpressure.py           # BackpressureController
│   ├── rate_limiting.py          # TokenBucket, RateLimiter
│   ├── overload.py               # HybridOverloadDetector
│   └── jitter.py                 # Jitter utilities
│
├── health/                       # Health checking
│   ├── __init__.py
│   ├── worker_health.py          # WorkerHealthState, three-signal model
│   ├── extension_tracker.py      # Adaptive extensions
│   └── probes.py                 # Liveness/Readiness probe implementations
│
└── swim/
    └── gates/                    # Gate SWIM extensions
        ├── __init__.py
        └── peer_topology.py      # GatePeerTopology
```

**Migration Plan**:
1. Create new module directories
2. Extract classes one at a time (preserve behavior)
3. Update imports in gate.py incrementally
4. Add tests for each extracted class
5. Final cleanup of gate.py
